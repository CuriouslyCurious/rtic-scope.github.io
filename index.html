<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-06-30 Wed 04:55 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RTIC Scope</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Viktor Vilhelm Sonesten" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">RTIC Scope</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgf4249a3">1. About</a>
<ul>
<li><a href="#org07b2d55">1.1. Features</a></li>
<li><a href="#org1b98037">1.2. Project repositories/crates</a></li>
</ul>
</li>
<li><a href="#orgf893081">2. Requirements</a>
<ul>
<li><a href="#orgb8e2e53">2.1. Hardware</a></li>
<li><a href="#org6664251">2.2. Software</a></li>
</ul>
</li>
<li><a href="#org34e16e4">3. Getting started</a>
<ul>
<li><a href="#org85a4009">3.1. Examples</a>
<ul>
<li><a href="#org72648ea">3.1.1. blinky</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgc0e04f7">4. How it works</a>
<ul>
<li><a href="#orge6d11b6">4.1. ITM/DWT subsystem</a></li>
<li><a href="#orgfe0a9d9">4.2. Host-side information recovery</a></li>
</ul>
</li>
<li><a href="#org5b580ed">5. Limitations</a>
<ul>
<li><a href="#org54cea49">5.1. Dropped ITM packets</a></li>
<li><a href="#org0e76c25">5.2. RTIC application constrains</a></li>
<li><a href="#org387be28">5.3. Target-side overhead</a></li>
</ul>
</li>
<li><a href="#org5fd3f6e">6. Frequently asked questions</a></li>
<li><a href="#org273e927">7. Roadmap</a></li>
<li><a href="#orga0f2552">8. Publications</a></li>
<li><a href="#org31c5d05">9. License</a></li>
<li><a href="#org9a79994">10. Contact, bug reports and contributions</a></li>
</ul>
</div>
</div>
<p>
<b>NOTE:</b> This document is a work in progress.
</p>

<hr />

<div id="outline-container-orgf4249a3" class="outline-2">
<h2 id="orgf4249a3"><span class="section-number-2">1.</span> About</h2>
<div class="outline-text-2" id="text-1">
<p>
<b>RTIC Scope</b> is a zero-overhead framework for recording and analyzing execution traces from <a href="https://rtic.rs">RTIC applications</a> on ARM Cortex-M targets.
The lack of overhead is achieved by exploiting the ITM/DWT subsystem as defined by the <a href="https://developer.arm.com/documentation/ddi0403/ed/">ARMv7-M Architecture Reference Manual</a>, Appendix D4.
</p>
</div>

<div id="outline-container-org07b2d55" class="outline-3">
<h3 id="org07b2d55"><span class="section-number-3">1.1.</span> Features</h3>
<div class="outline-text-3" id="text-1-1">
<p>
The framework is split into three chief components: the canonical backend, the frontend(s), and the target-side tracing crate, <code>cortex-m-rtic-trace</code>.
</p>

<dl class="org-dl">
<dt>The backend</dt><dd>is a host-side (i.e., the system that programs the target device) application which exposes two operations:
<dl class="org-dl">
<dt>Tracing</dt><dd>where the execution trace is captured from the target via a serial device and saved to file.</dd>
<dt>Replaying</dt><dd>where previously recorded traces are replayed for postmortem and offline analysis.</dd>
</dl></dd>
<dt>Frontend(s)</dt><dd><p>
While tracing and replaying, a trace can be forwarded to a set of frontends via Unix domain sockets, where virtually endless analytics can be applied.
Consider, for example, a graphical frontend alike an oscilloscope or a logic analyzer, but instead of signals the RTIC tasks and their executation status (running, scheduled, preempted) is plotted.
</p>

<p>
A dummy frontend which applies the backend-frontend API is offered out of the box.
It is available for debug and reference purposes.
You are encouraged to implement your own frontend, or adapt one developed by the community.
</p>

<p>
At present, information only flows from the backend to the frontend.
This is subject to change following a post-v1.0.0 release.
With bidirectional communication, a frontend can for example apply a complex hardware-in-the-loop testing suite.
Please refer to the <a href="#org273e927">project roadmap</a>.
</p></dd>
<dt>The target-side tracing crate</dt><dd><p>
<code>cortex-m-rtic-trace</code>, is an small auxiliary crate applied to the target application under trace.
It exposes:
</p>
<dl class="org-dl">
<dt>the <code>setup</code> module</dt><dd>which is used in the RTIC <code>#[init]</code> function.
It ensures that the target is properly configured to yield trace information to the host system after <code>#[init]</code> is exited.</dd>
<dt>the <code>#[trace]</code> macro</dt><dd>which is used to trace RTIC software tasks.
While hardware tasks are traced "free of charge" (see <a href="#orgc0e04f7">4</a>), software tasks are traced by writing a single <code>u32</code> variable.</dd>
</dl>

<p>
The aim of <code>cortex-m-rtic-trace</code> (and RTIC Scope as a whole) is to require minimal boilerplate to your RTIC applications.
</p></dd>
</dl>
</div>
</div>

<div id="outline-container-org1b98037" class="outline-3">
<h3 id="org1b98037"><span class="section-number-3">1.2.</span> Project repositories/crates</h3>
<div class="outline-text-3" id="text-1-2">
<p>
The framework is managed under the <a href="https://github.com/rtic-scope">RTIC Scope organization on GitHub</a>.
Below is a list of the chief repositories that constitute the project.
Any other crates listed under the organization but not here are branches of other repositories pending upstream merge.
</p>

<dl class="org-dl">
<dt><a href="https://github.com/rtic-scope/cargo-rtic-scope">cargo-rtic-scope</a></dt><dd>The RTIC Scope backend which builds the target application, recovers trace information, traces the target, replays traces, etc.</dd>
<dt><a href="https://github.com/rtic-scope/cortex-m-rtic-trace">cortex-m-rtic-trace</a></dt><dd>The <code>no_std</code> crate used to configure the target for tracing purposes.</dd>
<dt><a href="https://github.com/rtic-scope/examples">examples</a></dt><dd>A set of example target applications where the RTIC Scope framework is applied. These are also <a href="#org85a4009">documented below</a>.</dd>
<dt><a href="https://github.com/rtic-scope/frontend-dummy">frontend-dummy</a></dt><dd>A "noop" frontend implementation that writes received <code>api::EventChunk</code> structs to stderr with nanosecond timestamp information.</dd>
<dt><a href="https://github.com/rtic-scope/api">api</a></dt><dd>The common API used between the RTIC Scope backend and all frontends.</dd>
<dt><a href="https://github.com/rtic-scope/itm-decode">itm-decode</a></dt><dd>A host-side library that decodes the binary trace stream received from the target to workable Rust structures.</dd>
<dt><a href="https://github.com/rtic-scope/rfcs">rfcs</a></dt><dd>A catch-all meta-repository for discussions that encompasses more than a single repository.</dd>
<dt><a href="https://github.com/rtic-scope/rtic-scope.github.io">rtic-scope.github.io</a></dt><dd>The source code for this page.</dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-orgf893081" class="outline-2">
<h2 id="orgf893081"><span class="section-number-2">2.</span> Requirements</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orgb8e2e53" class="outline-3">
<h3 id="orgb8e2e53"><span class="section-number-3">2.1.</span> Hardware</h3>
<div class="outline-text-3" id="text-2-1">
<ul class="org-ul">
<li>A target device with an ARM Cortex-M4 MCU and available asynchronous trace pin output.</li>
<li>Serial hardware (The <a href="https://github.com/probe-rs/hs-probe">hs-probe</a> will be supported).</li>
</ul>
</div>
</div>

<div id="outline-container-org6664251" class="outline-3">
<h3 id="org6664251"><span class="section-number-3">2.2.</span> Software</h3>
<div class="outline-text-3" id="text-2-2">
<ul class="org-ul">
<li>A Linux-based operating system on which a recent Rust toolchain works and serial devices are POSIX-compliant.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org34e16e4" class="outline-2">
<h2 id="org34e16e4"><span class="section-number-2">3.</span> Getting started</h2>
<div class="outline-text-2" id="text-3">
<div class="org-src-container">
<pre class="src src-fundamental">$ cargo install cargo-rtic-scope
$ cargo install rtic-scope-frontend-dummy
</pre>
</div>
</div>

<div id="outline-container-org85a4009" class="outline-3">
<h3 id="org85a4009"><span class="section-number-3">3.1.</span> Examples</h3>
<div class="outline-text-3" id="text-3-1">
</div>
<div id="outline-container-org72648ea" class="outline-4">
<h4 id="org72648ea"><span class="section-number-4">3.1.1.</span> blinky</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
Assuming Nucleo and hs-probe&#x2026;
</p>
<div class="org-src-container">
<pre class="src src-fundamental">
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc0e04f7" class="outline-2">
<h2 id="orgc0e04f7"><span class="section-number-2">4.</span> How it works</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-orge6d11b6" class="outline-3">
<h3 id="orge6d11b6"><span class="section-number-3">4.1.</span> ITM/DWT subsystem</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Over serial communication a stream of back-to-back ITM packets are received.
Each packet contains a header and a number of payload bytes.
Of special interest are exception trace packets:
</p>
<blockquote>
<p>
The DWT unit can generate an Exception trace packet whenever then processor enters, exits, or returns to an exception.
&#x2014; Appendix D4.3.2
</p>
</blockquote>
<p>
This packet then contains one of the exception numbers listed in the table below.
In an RTIC application, tasks are bound to these numbers.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="all" frame="hsides">
<caption class="t-above"><span class="table-number">Table 1:</span> ARMv7-M Exception numbers</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Exception number</th>
<th scope="col" class="org-left">Exception name/label</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-left">Reset</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">NMI</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">HardFault</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-left">MemManage</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">BusFault</td>
</tr>

<tr>
<td class="org-right">7-10</td>
<td class="org-left">Reserved</td>
</tr>

<tr>
<td class="org-right">11</td>
<td class="org-left">SVCall</td>
</tr>

<tr>
<td class="org-right">12</td>
<td class="org-left">DebugMonitor</td>
</tr>

<tr>
<td class="org-right">13</td>
<td class="org-left">Reserved</td>
</tr>

<tr>
<td class="org-right">14</td>
<td class="org-left">PendSV</td>
</tr>

<tr>
<td class="org-right">15</td>
<td class="org-left">SysTick</td>
</tr>

<tr>
<td class="org-right">16</td>
<td class="org-left">External interrupt 0</td>
</tr>

<tr>
<td class="org-right">.</td>
<td class="org-left">.</td>
</tr>

<tr>
<td class="org-right">.</td>
<td class="org-left">.</td>
</tr>

<tr>
<td class="org-right">.</td>
<td class="org-left">.</td>
</tr>

<tr>
<td class="org-right">16 + N</td>
<td class="org-left">External interrupt N</td>
</tr>
</tbody>
</table>

<p>
Henceforth, this document will refer to these exceptions/interrupt numbers as interrupt request (IRQ) numbers.
</p>

<p>
Software tasks are similarly traced, but come at a cost of a <code>u32</code> variable write when entering and exiting the task.
This variable is registered as a watch address in the DWT subsystem.
Any writes to this address are intercepted, and the new value is encapsulated in an ITM packet along with the ID of the DWT comparator.
</p>
</div>
</div>

<div id="outline-container-orgfe0a9d9" class="outline-3">
<h3 id="orgfe0a9d9"><span class="section-number-3">4.2.</span> Host-side information recovery</h3>
<div class="outline-text-3" id="text-4-2">
<p>
The IRQ numbers we receive in a packet must be associated with the RTIC task that changed execution status.
This is done in a preparatory step before the target is flashed and traced.
For example, when executing <code>cargo rtic-scope --bin blinky --serial /dev/ttyUSB</code>:
</p>
<ol class="org-ol">
<li><code>blinky</code> is build via a regular <code>cargo build --bin blinky</code>.</li>
<li><p>
The RTIC application declaration, <code>#[app(...)] mod app {...}</code>, is parsed from <code>blinky</code>'s source code.
From this declaration, the <code>#[app(device = ...)]</code> argument is extracted along with the IRQ label from each <code>#[task(binds = ...)]</code> macro occurance.
Additionally, software tasks traced using the <code>#[trace]</code> macro are enumerated and mapped.
For example, <code>device = stm32f4::stm32f401</code>, <code>binds = SysTick</code>, and <code>binds = EXTI1</code> might be extracted.
Here, each IRQ label is associated with the RTIC task it is bound to.
</p>

<p>
This parsing step places some restrictions on how the source code for an RTIC application can be written. Refer to <a href="#org5b580ed">5</a>.
</p></li>
<li><p>
An adhoc cdylib crate is then built which translates IRQ labels to IRQ numbers.
For example, the adhoc crate might contain
</p>
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #5317ac;">use</span> <span style="color: #0000c0;">stm32f4</span>::<span style="color: #0000c0;">stm32f401</span>::<span style="color: #005a5f;">Interrupt</span>;

<span style="color: #505050;">// </span><span style="color: #505050;">Only external interrupts need be written here.</span>
<span style="color: #505050;">// </span><span style="color: #505050;">Exceptions-bound tasks are resolved using the above table.</span>

<span style="color: #a0132f;">#[no_mangle]</span>
<span style="color: #5317ac;">pub</span> <span style="color: #5317ac;">extern</span> <span style="color: #5317ac;">fn</span> <span style="color: #721045;">rtic_scope_func_EXTI1</span>() -&gt; <span style="color: #005a5f;">u8</span> {
    <span style="color: #005a5f;">Interrupt</span>::<span style="color: #005a5f;">EXTI1</span>.nr()
}
</pre>
</div>
<p>
After loading the resultant shared library and calling all functions, a <code>IRQ number -&gt; IRQ label -&gt; RTIC task</code> map ("task map") is yielded.
</p></li>
</ol>

<p>
Along with the task map, an absolute timestamp must also be calculated for each set of trace packets received.<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>
This is done by sampling the time just before the target is reset, and by waiting for the target to report the frequency of the trace clock via an ITM packet payload just before the end of <code>#[init]</code>.
This <code>(task map, reset timestamp, trace clock frequency)</code> tuple constitutes the metadata of a trace, and is saved as a header to all trace files.
</p>
</div>
</div>
</div>

<div id="outline-container-org5b580ed" class="outline-2">
<h2 id="org5b580ed"><span class="section-number-2">5.</span> Limitations</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org54cea49" class="outline-3">
<h3 id="org54cea49"><span class="section-number-3">5.1.</span> Dropped ITM packets</h3>
<div class="outline-text-3" id="text-5-1">
<ul class="org-ul">
<li>Any ITM packets sent before the trace clock frequency payload (TCFP) are currently dropped.
See <a href="https://github.com/rtic-scope/cargo-rtic-scope/issues/14">cargo-rtic-scope#14</a>.</li>
<li>If the input buffer of the serial device is filled, packets will be lost or corrupted.
See <a href="https://github.com/rtic-scope/cargo-rtic-scope/issues/11">cargo-rtic-scope#11</a>.</li>
</ul>
</div>
</div>

<div id="outline-container-org0e76c25" class="outline-3">
<h3 id="org0e76c25"><span class="section-number-3">5.2.</span> RTIC application constrains</h3>
</div>
<div id="outline-container-org387be28" class="outline-3">
<h3 id="org387be28"><span class="section-number-3">5.3.</span> Target-side overhead</h3>
<div class="outline-text-3" id="text-5-3">
<ul class="org-ul">
<li><code>cortex-m-rtic-trace::setup</code> must be properly used in <code>#[init]</code> to configure the ITM/DWT peripherals.
Please refer to the crate documentation on the applied configuration.</li>
<li>Before <code>#[init]</code> is exited, a <code>u32</code> denoting the frequency of the trace clock must be found and written to a watch address.<sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup></li>
<li>When tracing software tasks:
<ul class="org-ul">
<li>a DWT comparator must be effectively consumed.
Additionally, the ID of the comparator must be communicated to the backend by writing the value to a watch address.</li>
<li>When entering/exiting a software task marked for tracing, a <code>u8</code> (at minimum) must be written to a watch addess;
a <code>u32</code> in the worst case (depending on the number of tracing software tasks<sup><a id="fnr.3" class="footref" href="#fn.3">3</a></sup>).</li>
</ul></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org5fd3f6e" class="outline-2">
<h2 id="org5fd3f6e"><span class="section-number-2">6.</span> Frequently asked questions</h2>
<div class="outline-text-2" id="text-6">
<dl class="org-dl">
<dt>Where are all build artifacts stored?</dt><dd><p>
Most likely under <code>target/</code>, assuming the current working directory is a crate containing target applications.
The target directory can be overridden via <code>TARGET_DIR</code> or the <code>--target-dir</code> option.
Note that the RTIC application will be rebuilt to this location.
</p>

<p>
<code>cargo rtic-scope</code> also respecets <a href="https://doc.rust-lang.org/cargo/reference/config.html">Cargo's configuration system</a>.
</p></dd>
<dt>Where are all traces saved to?</dt><dd><p>
Recorded traces are serialized to JSON to <code>/path/to/target-dir/rtic-traces</code>, which means <code>target/rtic-traces</code> by default.
This directory can be overridden via the <code>--trace-dir</code> option.
The same option  is used to replay traces located in non-default location.
</p>

<p>
<b>NOTE:</b> any traces saved to the target directory will be lost on a <code>cargo clean</code>.
</p></dd>
</dl>
</div>
</div>

<div id="outline-container-org273e927" class="outline-2">
<h2 id="org273e927"><span class="section-number-2">7.</span> Roadmap</h2>
</div>

<div id="outline-container-orga0f2552" class="outline-2">
<h2 id="orga0f2552"><span class="section-number-2">8.</span> Publications</h2>
</div>

<div id="outline-container-org31c5d05" class="outline-2">
<h2 id="org31c5d05"><span class="section-number-2">9.</span> License</h2>
<div class="outline-text-2" id="text-9">
<p>
TBA
</p>
</div>
</div>

<div id="outline-container-org9a79994" class="outline-2">
<h2 id="org9a79994"><span class="section-number-2">10.</span> Contact, bug reports and contributions</h2>
<div class="outline-text-2" id="text-10">
<p>
Bug reports and contributions are welcome. Please file it under the <a href="#org1b98037">relevant repository</a>.
</p>

<p>
Project maintainer can be reached via email at <a href="mailto:vikson-6@student.ltu.se">&lt;vikson-6@student.ltu.se&gt;</a>.
</p>

<hr />
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
An absolute timestamp <i>mustn't</i> be calculated, but they come in handy.
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara">
The TCFP <i>mustn't</i> be send at the tail-end of <code>#[init]</code>, but it is highly recommended. It must in any case be sent: it is expected by the backend to generate the trace metadata.
</p></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3">3</a></sup> <div class="footpara"><p class="footpara">
The overhead will be <code>u8</code> unless your application has more than 256 software tasks.
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="author">Author: Viktor Vilhelm Sonesten</p>
<p class="date">Created: 2021-06-30 Wed 04:55</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
